{% extends 'index.html' %}
{% load bootstrap4 %}
{% load static %}
{% block content %}

{{result | json_script:"jsonData"}}

<script type="text/javascript" src="http://maps.google.com/maps/api/js?key={{result.api_key}}" ></script>
<style>
.map {width:100%; height:300px; clear:both; border:solid 1px red; display:hidden;}
.map_cover {display:none;}
article div{overflow:visible}
</style>
<script type="text/javascript">
    $('#imageSelect').attr('style', 'display:none;');

    var data = JSON.parse(document.getElementById("jsonData").textContent)

    var maps = [];
    var markers = [];

    $(document).ready(function() {

        var $maps = $('.map');

        $.each($maps, function (i, value) {
            console.log("lat: "+$(value).attr('lat'));
            var latlng = { lat: parseFloat($(value).attr('lat')), lng: parseFloat($(value).attr('lng')) };
            console.log(latlng)
            var mapDivId = $(value).attr('id');
            var zoomLevel = 16;
            var markerTitle = $(value).attr('title');
            var markerMaxWidth = 300;
            var contentString = '<div>' + '지오코딩 예정' + '</div>';

            var mapOptions = {
                        zoom: zoomLevel,
                        center: latlng,
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                     }

            maps[mapDivId] = new google.maps.Map(document.getElementById(mapDivId), mapOptions);

            markers[mapDivId] = new google.maps.Marker({
                position: latlng,
                map: maps[mapDivId]
            });

            var infowindow = new google.maps.InfoWindow(
                                                {
                                                    content: contentString,
                                                    maxWidth: markerMaxWidth
                                                }
                                                );
            google.maps.event.addListener(markers[mapDivId], 'click', function() {
                infowindow.open(maps[mapDivId], markers[mapDivId]);
            });
        })
    })

    function mapON(site) {

        $('#map_cover_'+site).attr('style', 'display:inline');
        $('#btn_'+site).attr('style','display:none')
        $('#btn2_'+site).attr('style','display:inline-block')
    }

    function mapOFF(site) {
        $('#map_cover_'+site).attr('style', 'display:none;');
        $('#btn_'+site).attr('style','display:inline-block')
        $('#btn2_'+site).attr('style','display:none')
    }

</script>



<div class="content">
    <div class="toDoDiv">
        <ul class="list-group">
            <script type="text/javascript">
                for (site in data['recommand_list'])
                {
                    name = data['recommand_list'][site]['name'];
                    category = data['recommand_list'][site]['category']
                    lat = data['recommand_list'][site]['lat']
                    lng = data['recommand_list'][site]['lng']
                    document.write("<li class=\"list-group-item\">")
                    document.write("<table style=\"width: 80%; margin:auto;\"><tr>")
                    document.write("<td style=\"width:20%;\">이름 : " + name + "</td>")
                    document.write("<td style=\"width:10%\">분류 : " + category + "</td>")
                    document.write("<td style=\"width:20%\">위치 : " + lat + "," + lng + "</td>")
                    document.write("<td style=\"width:20%;\">")
                    document.write("<button id=\"btn_" + site +"\" onclick=\"mapON(\'" + site + "\')\">위치 보기</button>")
                    document.write("<button id=\"btn2_" + site +"\" onclick=\"mapOFF(\'" + site + "\')\" style=\"display:none\">지도 접기</button>")
                    document.write("</td>")
                    document.write("</tr></table>")
                    document.write("<div class=\"map_cover\" id=\"map_cover_" + site +"\">")
                    document.write("<div class=\"map\" id=\"map_" + site + "\" lat=\"" + lat+ "\" lng=\"" + lng + "\" title=\"" + name + "\"></div>")
                    document.write("</div>")
                    document.write("</li>")
                }
            </script>
        </ul>
    </div>
</div>



{% endblock %}